diff -ru adchpp_2.8.0_source.orig//SConstruct adchpp_2.8.0_source//SConstruct
--- adchpp_2.8.0_source.orig//SConstruct	2012-02-24 07:15:25.533177571 +0100
+++ adchpp_2.8.0_source//SConstruct	2012-02-25 04:41:51.205484894 +0100
@@ -89,6 +89,7 @@
 	('prefix', 'Prefix to use when cross compiling', ''),
 	EnumVariable('arch', 'Target architecture', 'x86', ['x86', 'x64', 'ia64']),
 	('python', 'Python path to use when compiling python extensions', distutils.sysconfig.get_config_var('prefix')),
+	('ruby', 'Path to the ruby binary', 'ruby'),
 	BoolVariable('docs', 'Build docs (requires asciidoc)', 'no')
 )
 
@@ -188,8 +189,6 @@
 		conf.env.Append(CPPDEFINES='HAVE_POLL_H')
 	if conf.CheckCHeader('sys/epoll.h'):
 		conf.env.Append(CPPDEFINES=['HAVE_SYS_EPOLL_H'])
-	if conf.CheckCHeader('ruby.h'):
-		conf.env['HAVE_RUBY_H'] = True
 	if conf.CheckLib('dl', 'dlopen'):
 		conf.env.Append(CPPDEFINES=['HAVE_DL'])
 	if not dev.is_win32():
diff -ru adchpp_2.8.0_source.orig//swig/SConscript adchpp_2.8.0_source//swig/SConscript
--- adchpp_2.8.0_source.orig//swig/SConscript	2012-02-24 07:15:25.531177571 +0100
+++ adchpp_2.8.0_source//swig/SConscript	2012-02-25 04:41:31.767484854 +0100
@@ -18,12 +18,13 @@
 		return ""
 
 def getRbConf(name):
-	return runCommand(['ruby', '-rmkmf', '-e', "print Config.expand('$(" + name + ")')"])
+	return runCommand([dev.env['ruby'], '-rmkmf', '-e', "print RbConfig.expand('$(" + name + ")')"])
 
 def buildRbModule():
 	env = dev.env.Clone()
+	conf = Configure(env)
 
-	if 'HAVE_RUBY_H' not in env or not runCommand(['ruby', '-v']):
+	if not runCommand([dev.env['ruby'], '-v']):
 		print "Ruby not found, skipping ruby module"
 		return
 
@@ -69,6 +70,10 @@
 		
 	rb = env.SharedLibrary(dev.get_target(source_path, 'rbadchpp'), [f],
 						SHLIBPREFIX='')
+	if not conf.CheckCHeader( 'ruby.h' ):
+		print "ruby.h not found, skipping ruby module"
+		return
+
 	targets.append(rb)
 
 def buildPyModule():
